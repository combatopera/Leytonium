#!/bin/bash

#HALP Merge master into all PRs and carrion.

set -e

. git_functions

cdtocorda

prefix=$(githubuser)-

# FIXME: Do things in dependency graph order, in particular for kitchen-sink.
function mergethem {
    local b
    for b in $(allbranches); do
        git checkout $b
        if ispublic && ! [[ $b =~ $prefix* ]]; then
            echo Skip: $b >&2
        elif [[ $b =~ controversial-* || $b = kitchen-sink ]] || ispublic; then
            git merge --no-edit $(pb)
        else
            git rebase $(pb)
        fi
    done
}

nicely mergethem
