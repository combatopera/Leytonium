#!/bin/bash

#HALP Merge master into all PRs and carrion.

set -e

. git_functions

cdtocorda

prefix=$(githubuser)-

function mergeone {
    git checkout $1
    local parent=$(pb)
    if [[ $1 = carrion-* && -e .pb/$1 ]]; then # Second bit is a hack during transitional period.
        git rebase $parent
    else
        git merge --no-edit $parent
    fi
}

function mergethem {
    for b in $(publicbranches); do
        [[ $b != $prefix* ]] || mergeone $b
    done
    for b in $(allbranches); do
        [[ $b != carrion-* && $b != controversial-* ]] || mergeone $b
    done
}

nicely mergethem
