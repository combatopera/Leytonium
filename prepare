#!/usr/bin/env python3

#HALP Create a master-based branch from this non-master-based one.

from common import thisbranch, pb, branchcommits, runpy, run, findproject, infodirname
import os

def main():
    master = 'master'
    parent = pb()
    if parent == master:
        raise Exception("Parent is already %s!" % master)
    name = thisbranch()
    commits = [commit for commit, _ in branchcommits(name)]
    runpy(['ren', "%s.bak" % name])
    run(['git', 'checkout', '-b', name, master])
    with open(os.path.join(findproject(), infodirname, name), 'w') as f:
        print(master, file = f)
    run(['git', 'cherry-pick'] + commits)

if '__main__' == __name__:
    main()
